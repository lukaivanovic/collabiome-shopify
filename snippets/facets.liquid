{% comment %}
  Facets/filters snippet for collection filtering
  Uses Shopify native filters with URL-based filtering
  Horizontal multi-select dropdown layout
{% endcomment %}

{% liquid
  assign filters = collection.filters
  assign has_active_filters = false

  for filter in filters
    if filter.active_values.size > 0
      assign has_active_filters = true
      break
    endif
  endfor
%}

{% comment %} Horizontal filters with dropdowns {% endcomment %}
<facet-filter-form>
  <form id="FacetFiltersForm" class="flex flex-col gap-4">
    {% comment %} Filter dropdowns {% endcomment %}
    <div class="flex flex-wrap md:flex-row gap-2 items-start">
      {% for filter in filters %}
        {% case filter.type %}
          {% when 'list' %}
            <facet-select class="relative inline-block" data-filter-label="{{ filter.label }}">
              <button
                type="button"
                data-select-button
                class="flex items-center justify-between gap-2 px-4 h-8 bg-transparent border border-black rounded-full text-sm font-medium text-black cursor-pointer transition-all hover:opacity-100 opacity-50 whitespace-nowrap w-full md:w-auto"
                aria-expanded="false"
              >
                <span>{{ filter.label }}</span>
                <span class="flex-shrink-0 transition-transform duration-200" data-chevron-icon>
                  {{ 'icon-chevron-down.svg' | inline_asset_content }}
                </span>
              </button>
              <div
                class="absolute top-[calc(100%+0.25rem)] left-0 z-50 min-w-[200px] max-w-[280px] w-full md:w-auto max-h-[300px] overflow-y-auto bg-white border border-neutral-200 rounded-md shadow-lg hidden"
                data-select-panel
              >
                <ul class="list-none p-2 m-0 flex flex-col gap-1">
                  {% for value in filter.values %}
                    <li class="block">
                      <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                        <input
                          type="checkbox"
                          name="{{ filter.param_name }}"
                          value="{{ value.value }}"
                          class="w-4 h-4 cursor-pointer flex-shrink-0"
                          {% if value.active %}
                            checked
                          {% endif %}
                          {% if value.count == 0 and value.active == false %}
                            disabled
                          {% endif %}
                        >
                        <span class="flex items-center gap-1 text-black">
                          {{ value.label }}
                          <span class="text-gray-500 font-normal">({{ value.count }})</span>
                        </span>
                      </label>
                    </li>
                  {% endfor %}
                </ul>
              </div>
            </facet-select>

          {% when 'boolean' %}
            <facet-select class="relative inline-block" data-filter-label="{{ filter.label }}">
              <button
                type="button"
                data-select-button
                class="flex items-center justify-between gap-2 px-4 h-8 bg-transparent border border-black rounded-full text-sm font-medium text-black cursor-pointer transition-all hover:opacity-100 opacity-50 whitespace-nowrap w-full md:w-auto"
                aria-expanded="false"
              >
                <span>{{ filter.label }}</span>
                <span class="flex-shrink-0 transition-transform duration-200" data-chevron-icon>
                  {{ 'icon-chevron-down.svg' | inline_asset_content }}
                </span>
              </button>
              <div
                class="absolute top-[calc(100%+0.25rem)] left-0 z-50 min-w-[200px] max-w-[280px] w-full md:w-auto max-h-[300px] overflow-y-auto bg-white border border-neutral-200 rounded-md shadow-lg hidden"
                data-select-panel
              >
                <ul class="list-none p-2 m-0 flex flex-col gap-1">
                  <li class="block">
                    <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                      <input
                        type="checkbox"
                        name="{{ filter.param_name }}"
                        value="{{ filter.true_value.value }}"
                        class="w-4 h-4 cursor-pointer flex-shrink-0"
                        {% if filter.true_value.active %}
                          checked
                        {% endif %}
                        {% if filter.true_value.count == 0 and filter.true_value.active == false %}
                          disabled
                        {% endif %}
                      >
                      <span class="flex items-center gap-1 text-black">
                        {{ filter.true_value.label }}
                        <span class="text-gray-500 font-normal">({{ filter.true_value.count }})</span>
                      </span>
                    </label>
                  </li>
                  <li class="block">
                    <label class="flex items-center gap-2 cursor-pointer py-1.5 px-2 rounded text-sm transition-colors hover:bg-gray-100">
                      <input
                        type="checkbox"
                        name="{{ filter.param_name }}"
                        value="{{ filter.false_value.value }}"
                        class="w-4 h-4 cursor-pointer flex-shrink-0"
                        {% if filter.false_value.active %}
                          checked
                        {% endif %}
                        {% if filter.false_value.count == 0 and filter.false_value.active == false %}
                          disabled
                        {% endif %}
                      >
                      <span class="flex items-center gap-1 text-black">
                        {{ filter.false_value.label }}
                        <span class="text-gray-500 font-normal">({{ filter.false_value.count }})</span>
                      </span>
                    </label>
                  </li>
                </ul>
              </div>
            </facet-select>

          {% when 'price_range' %}
            <div class="flex flex-col md:flex-row md:items-center items-start gap-3 px-4 h-8 bg-transparent border border-black rounded-full w-full opacity-50 transition-all hover:opacity-100">
              <label class="text-sm font-medium text-black whitespace-nowrap">{{ filter.label }}</label>
              <div class="flex gap-2 items-center w-full md:w-auto">
                <label class="flex items-center gap-1 text-sm text-black">
                  <span>{{ 'filters.price_from' | t | default: 'From' }}</span>
                  <input
                    type="number"
                    name="{{ filter.min_value.param_name }}"
                    value="{{ filter.min_value.value | default: '' }}"
                    placeholder="{{ filter.range_min | money_without_currency }}"
                    class="px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 w-20 md:w-20 flex-1 md:flex-initial"
                  >
                </label>
                <label class="flex items-center gap-1 text-sm text-black">
                  <span>{{ 'filters.price_to' | t | default: 'To' }}</span>
                  <input
                    type="number"
                    name="{{ filter.max_value.param_name }}"
                    value="{{ filter.max_value.value | default: '' }}"
                    placeholder="{{ filter.range_max | money_without_currency }}"
                    class="px-2 py-1.5 border border-gray-300 rounded text-sm focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 w-20 md:w-20 flex-1 md:flex-initial"
                  >
                </label>
              </div>
            </div>
        {% endcase %}
      {% endfor %}

      {% comment %} Clear all button {% endcomment %}
      <a
        href="{{ collection.url }}"
        class="px-4 h-8 flex items-center justify-center bg-transparent border border-black rounded-full text-sm font-medium text-black no-underline transition-all hover:opacity-100 opacity-50 whitespace-nowrap {% unless has_active_filters %}cursor-not-allowed pointer-events-none{% endunless %}"
        {% unless has_active_filters %}
          aria-disabled="true" tabindex="-1"
        {% endunless %}
      >
        {{ 'filters.clear_all' | t | default: 'Oƒçisti sve' }}
      </a>
    </div>
  </form>
</facet-filter-form>

{% stylesheet %}
  /* Dropdown chevron icon rotation */
  [data-select-button][aria-expanded='true'] [data-chevron-icon] {
    transform: rotate(180deg);
  }

  [data-chevron-icon] svg {
    display: block;
    width: 1rem;
    height: 1rem;
  }
{% endstylesheet %}
