{% comment %}
  Facets/filters snippet for collection filtering
  Uses Shopify native filters with URL-based filtering
  Horizontal multi-select dropdown layout
{% endcomment %}

{% liquid
  assign filters = collection.filters
  assign restrict_to_prioritized_filters = false
  assign restrict_mode = ''

  if collection.handle == 'kozmetika' or collection.handle == 'cosmetics'
    assign restrict_to_prioritized_filters = true
    assign restrict_mode = 'cosmetics'
  elsif collection.handle == 'paketi' or collection.handle == 'bundles'
    assign restrict_to_prioritized_filters = true
    assign restrict_mode = 'bundles'
  endif

  assign has_active_filters = false

  for filter in filters
    if filter.active_values.size > 0
      assign has_active_filters = true
      break
    endif
  endfor
%}

{% comment %} Horizontal filters with dropdowns {% endcomment %}
<facet-filter-form>
  <form id="FacetFiltersForm" class="flex flex-col gap-4">
    {% comment %} Filter dropdowns {% endcomment %}
    <div class="flex flex-wrap md:flex-row gap-2 items-start">
      {% if restrict_to_prioritized_filters %}
        {% if restrict_mode == 'cosmetics' %}
            {% for filter in filters %}
              {% if filter.label == 'Tip kože' or filter.label == 'Korak rutine' or filter.label == 'Kožni problem' %}
                {% render 'facet-filter-item', filter: filter %}
              {% endif %}
          {% endfor %}
        {% elsif restrict_mode == 'bundles' %}
          {% for filter in filters %}
            {% if  filter.label == 'Tip paketa' %}
              {% render 'facet-filter-item', filter: filter %}
            {% endif %}
          {% endfor %}
        {% endif %}
      {% else %}
        {% for filter in filters %}
          {% render 'facet-filter-item', filter: filter %}
        {% endfor %}
      {% endif %}

      {% comment %} Clear all button {% endcomment %}
      <a
        href="{{ collection.url }}"
        class="px-4 h-8 flex items-center justify-center bg-transparent  rounded-full text-sm font-medium text-neutral-500 no-underline whitespace-nowrap {% unless has_active_filters %}cursor-not-allowed pointer-events-none{% endunless %}"
        {% unless has_active_filters %}
          aria-disabled="true" tabindex="-1"
        {% endunless %}
      >
        Očisti sve
      </a>
    </div>
  </form>
</facet-filter-form>

{% stylesheet %}
  /* Dropdown chevron icon rotation */
  [data-select-button][aria-expanded='true'] [data-chevron-icon] {
    transform: rotate(180deg);
  }

  [data-chevron-icon] svg {
    display: block;
    width: 0.75rem;
    height: 0.75rem;
  }
{% endstylesheet %}
