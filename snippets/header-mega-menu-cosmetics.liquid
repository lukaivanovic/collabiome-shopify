{% doc %}
  Header Mega Menu - Cosmetics

  Renders a custom mega menu panel for the cosmetics collection with hardcoded filter links.
{% enddoc %}

{% liquid
  # Prefer explicit cosmetics collection handles, fall back if needed
  assign cosmetics_collection = collections.kozmetika

  # Use featured_products metafield when available, otherwise fall back to collection products
  assign featured_products = blank

  if cosmetics_collection.metafields.custom and cosmetics_collection.metafields.custom.featured_products
    assign featured_products = cosmetics_collection.metafields.custom.featured_products.value
  endif

  if featured_products == blank
    assign featured_products = cosmetics_collection.products
  endif

  unless cosmetics_collection and cosmetics_collection != empty
    break
  endunless
%}

<div
  class="mega-menu-panel pointer-events-none absolute left-0 top-[calc(100%-16px)] w-full aria-[hidden=false]:pointer-events-auto"
  data-mega-menu-panel="{{ cosmetics_collection.handle }}"
  aria-hidden="true"
>
  <div class="container py-3">
    <div
      class="mega-menu-card rounded-2xl border border-black/12 bg-[var(--color-background-default)]"
      data-mega-menu-card
    >
      <div class="flex flex-row gap-8 p-8">
        <div class="flex flex-col gap-5">
          <div class="flex flex-row justify-between gap-20">
            {% comment %} Tip kože {% endcomment %}
            <div class="flex flex-col gap-1 ">
              <p class="m-0 text-xs font-medium uppercase tracking-wide text-primary/70">Tip kože</p>
              <ul class="m-0 list-none space-y-1 p-0">
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.skin_type=dry"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Suha
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.skin_type=oily"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Masna
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.skin_type=combination"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Mješovita
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.skin_type=normal"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Normalna
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.skin_type=sensitive"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Osjetljiva
                  </a>
                </li>
              </ul>
            </div>

            {% comment %} Dio rutine {% endcomment %}
            <div class="flex flex-col gap-1">
              <p class="m-0 text-xs font-medium uppercase tracking-wide text-primary/70">Dio rutine</p>
              <ul class="m-0 list-none space-y-1 p-0">
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.routine_part=cleanser"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Čišćenje lica
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.routine_part=exfoliation"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Eksfolacija lica
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.routine_part=serum"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Serumi
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.routine_part=moisturizer"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Hidratantne kreme
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.routine_part=night_care"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Noćna njega
                  </a>
                </li>
              </ul>
            </div>

            {% comment %} Kožni problemi {% endcomment %}
            <div class="flex flex-col gap-1 ">
              <p class="m-0 text-xs font-medium uppercase tracking-wide text-primary/70">Kožni problemi</p>
              <ul class="m-0 list-none space-y-1 p-0">
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=acne"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Nečista koža
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=redness"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Crvenilo i nadraženost
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=clogged_pores"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Začepljene pore
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=enlarged_pores"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Proširene pore
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=discoloration"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Diskoloracija
                  </a>
                </li>
                <li>
                  <a
                    href="{{ cosmetics_collection.url }}?filter.p.m.custom.problem_solution=aging"
                    class="text-sm text-primary transition-colors duration-200 hover:text-primary/80 no-underline"
                  >
                    Bore
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="ml-auto flex w-full max-w-sm min-w-150 flex-col gap-3">
          {% comment %} Quiz Banner Card {% endcomment %}
          {% render 'quiz-banner', variant: 'mobile' %}

          {% comment %} Featured Product Card {% endcomment %}
          {% liquid
            assign featured_product = settings.mega_menu_featured_product
          %}
          {% if featured_product and featured_product != blank %}
            <a
              href="{{ featured_product.url }}"
              class="relative flex items-end overflow-hidden bg-black text-white rounded-xl h-28 px-3 py-3"
            >
              <div class="absolute inset-0 z-0 overflow-hidden" aria-hidden="true">
                {% if featured_product.featured_media %}
                  {{
                    featured_product.featured_media
                    | image_url: width: 800
                    | image_tag:
                      loading: 'lazy',
                      sizes: '100vw',
                      alt: featured_product.title,
                      class: 'absolute inset-0 w-full h-full object-cover'
                  }}
                {% else %}
                  <div class="w-full h-full bg-gradient-to-r from-black/60 to-black/30"></div>
                {% endif %}
                <div
                  class="absolute inset-0 pointer-events-none"
                  style="background: #000000; opacity: 0.4;"
                ></div>
              </div>

              <div class="relative z-10 w-full flex justify-between gap-3">
                <div>
                  <h3 class="font-semibold leading-snug text-white">
                    {{ featured_product.title | escape }}
                  </h3>
                  {% if featured_product.description != blank %}
                    {% liquid
                      assign product_description = featured_product.description | strip_html | truncate: 80
                    %}
                    <p class="text-xs text-white/70 mt-1">
                      {{ product_description }}
                    </p>
                  {% endif %}
                </div>
                <div class="flex items-center text-white [&>svg]:w-5 [&>svg]:h-5">
                  {{ 'icon-chevron-right.svg' | inline_asset_content }}
                </div>
              </div>
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
