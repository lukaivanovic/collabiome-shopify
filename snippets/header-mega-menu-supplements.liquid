{% doc %}
  Header Mega Menu - Supplements

  Renders a custom mega menu panel for the supplements collection.

  @param {linklist} supplements_menu - Secondary menu for supplements collections
{% enddoc %}

{% liquid
  assign supplements_menu = supplements_menu | default: empty

  # Prefer explicit supplements collection handles, fall back if needed
  assign supplements_collection = collections['dodaci-prehrani'] | default: collections.supplements

  # Use featured_products metafield when available, otherwise fall back to collection products
  assign featured_products = blank

  if supplements_collection.metafields.custom and supplements_collection.metafields.custom.featured_products
    assign featured_products = supplements_collection.metafields.custom.featured_products.value
  endif

  if featured_products == blank
    assign featured_products = supplements_collection.products
  endif

  unless supplements_collection and supplements_collection != empty
    break
  endunless
%}

<div
  class="mega-menu-panel pointer-events-none absolute left-0 top-[calc(100%-16px)] w-full aria-[hidden=false]:pointer-events-auto"
  data-mega-menu-panel="{{ supplements_collection.handle }}"
  aria-hidden="true"
>
  <div class="container py-3">
    <div
      class="mega-menu-card rounded-2xl border border-black/12 bg-[var(--color-background-default)]"
      data-mega-menu-card
    >
      <div class="grid gap-4 p-8 md:grid-cols-4">
        {% for product in featured_products limit: 3 %}
          {% liquid
            assign product_theme = product.metafields.custom.theme.value | default: 'default'

            case product_theme
              when 'recupera'
                assign product_theme_class = 'product-theme-recupera'
              when 'boost'
                assign product_theme_class = 'product-theme-boost'
              else
                assign product_theme_class = 'product-theme-default'
            endcase
          %}

          <div
            class="[background:var(--product-background)] {{ product_theme_class }} flex flex-col gap-3 rounded-xl p-4 no-underline"
          >
            <div class="flex flex-col gap-1">
              <h3 class="text-base font-semibold text-primary">
                {{ product.title }}
              </h3>
              {% if product.description != blank %}
                <p class="text-sm text-primary/80 line-clamp-3">
                  {{ product.description | strip_html | truncatewords: 24 }}
                </p>
              {% endif %}
            </div>
            {% render 'product-card', product: product, hide_buy_form: true %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
