{%- liquid
  assign science_title = product.metafields.custom.section_science_title.value | default: product.metafields.custom.section_science_title
  assign science_description = product.metafields.custom.section_science_description.value | default: product.metafields.custom.section_science_description
  assign science_studies = product.metafields.custom.section_science_studies.value | default: product.metafields.custom.section_science_studies
  assign science_image = product.metafields.custom.section_science_image.value | default: product.metafields.custom.section_science_image

  assign fallback_title = 'sections.product_science.default_title' | t
  assign section_title = science_title | default: fallback_title
  assign fallback_description = 'sections.product_science.default_description' | t
  assign section_description = science_description | default: fallback_description

  assign has_description = false
  if section_description != blank
    assign has_description = true
  endif

  assign has_studies = false
  if science_studies != blank
    assign has_studies = true
  endif

  assign has_image = false
  if science_image != blank
    assign has_image = true
  endif

  assign product_theme = product.metafields.custom.theme.value | default: 'default'

  case product_theme
    when 'recupera'
      assign product_theme_class = 'product-theme-recupera'
    when 'boost'
      assign product_theme_class = 'product-theme-boost'
    else
      assign product_theme_class = 'product-theme-default'
  endcase
-%}

<section class="py-20 [background:var(--product-background)] {{ product_theme_class }}">
  <div class="container">
    <div class="flex flex-col gap-12 lg:flex-row lg:items-center lg:gap-16">
      <div class="flex-1">
        <div class="max-w-140">
          <h2 class="text-4xl font-medium">{{ section_title }}</h2>
          {% if has_description %}
            <p class="mt-4 text-base">{{ section_description }}</p>
          {% endif %}
        </div>

        {% if has_studies %}
          <div class="mt-12 flex flex-wrap gap-4">
            {% for study in science_studies %}
              {% liquid
                assign study_metric = study.metric | default: study.title
                assign study_text = study.description | default: study.desc
                assign study_source = study.source
                assign study_link = study.link
                assign study_link_url = ''
                assign study_link_label = ''

                if study_link != blank
                  if study_link.url
                    assign study_link_url = study_link.url
                    assign study_link_label = study_link.title
                  else
                    assign study_link_url = study_link
                  endif
                endif

                assign computed_link_label = study_link_label
                if computed_link_label == blank
                  assign computed_link_label = 'sections.product_science.link_label' | t
                endif
              %}

              <div class="rounded-2xl bg-[var(--product-accent)] p-6">
                {% if study_metric %}
                  <p class="text-5xl font-semibold text-[var(--product-background)]">
                    {{ study_metric }}
                  </p>
                {% endif %}

                {% if study_text %}
                  <p class="mt-3 text-sm text-[var(--product-background)]">{{ study_text }}</p>
                {% endif %}

                {% if study_source or study_link_url %}
                  <div class="mt-5 flex flex-col gap-2 text-xs text-[var(--product-background)]/80">
                    {% if study_source %}
                      {% if study_link_url != blank %}
                        <a
                          href="{{ study_link_url }}"
                          class="font-medium text-[var(--product-background)] underline"
                          target="_blank"
                          rel="noopener"
                        >
                          {{- 'sections.product_science.source_prefix' | t: source: study_source -}}
                        </a>
                      {% else %}
                        <span class="font-medium text-[var(--product-background)]">
                          {{- 'sections.product_science.source_prefix' | t: source: study_source -}}
                        </span>
                      {% endif %}
                    {% endif %}
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      {% if has_image %}
        <div class="flex-shrink-0 lg:w-1/2">
          <div class="max-h-[600px] overflow-hidden rounded-2xl">
            {% render 'image', image: science_image, class: 'w-full rounded-2xl' %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "t:sections.product_science.name",
  "tag": "section",
  "class": "product-science",
  "presets": [
    {
      "name": "t:sections.product_science.name",
      "category": "t:sections.product_science.category"
    }
  ]
}
{% endschema %}
