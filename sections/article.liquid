{% comment %}
  This section is used in the article template to render the article page, which
  displays the full content of the blog post and can optionally include a
  comments section for customers (not shown in this example).

  https://shopify.dev/docs/storefronts/themes/architecture/templates/article
{% endcomment %}

{% liquid
  assign words_per_minute = 220
  assign word_count = article.content | strip_html | split: ' ' | size
  assign reading_time = word_count | divided_by: words_per_minute
  assign reading_time_remainder = word_count | modulo: words_per_minute
  if reading_time == 0 and word_count > 0
    assign reading_time = 1
  endif
  if reading_time_remainder > 0
    assign reading_time = reading_time | plus: 1
  endif

  assign published_at = article.published_at | time_tag: format: 'date'
  assign published_at = published_at | replace: '<time', '<time class="font-semibold text-neutral-900"'

  assign article_theme = section.settings.article_theme | default: 'default'
  case article_theme
    when 'recupera'
      assign product_theme_class = 'product-theme-recupera'
    when 'boost'
      assign product_theme_class = 'product-theme-boost'
    else
      assign product_theme_class = 'product-theme-default'
  endcase
%}

<section class="relative {{ product_theme_class }}">
  {% if article.image %}
    <figure class="relative w-full h-80 md:h-96 overflow-hidden">
      {{
        article.image
        | image_url: width: 2048
        | image_tag:
          loading: 'eager',
          class: 'h-full w-full object-cover',
          sizes: '100vw',
          alt: article.image.alt | default: article.title | escape
      }}
      <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-transparent"></div>
    </figure>
  {% endif %}

  <div class="container-small pt-20 -mt-80 md:-mt-96 pb-16 md:pb-24 lg:pb-28">
    <article class="relative isolate overflow-hidden {{ product_theme_class }}">
      <div class="absolute inset-0 opacity-80 [background:var(--product-background)]"></div>
      <div class="relative z-10 flex flex-col gap-12 bg-white/85 px-6 py-10 backdrop-blur-xl sm:px-10 lg:px-16">
        <div class="flex flex-col gap-6">
          <a
            href="{{ blog.url }}"
            class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.35em] text-neutral-500 transition-colors hover:text-[var(--product-accent)]"
          >
            {{ 'blogs.article.back_link' | t: blog: blog.title }}
            <span aria-hidden="true" class="text-[var(--product-accent)]">→</span>
          </a>

          <div class="flex flex-col gap-4">
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-[11px] font-semibold uppercase tracking-[0.4em] text-neutral-500">
              <span class="text-[var(--product-accent)]">
                {{ blog.title }}
              </span>
              {% if reading_time > 0 %}
                <span class="inline-flex items-center gap-2 text-neutral-400">
                  <span class="h-1 w-1 rounded-full bg-neutral-400"></span>
                  {{ 'blogs.article.meta.reading_time' | t: minutes: reading_time }}
                </span>
              {% endif %}
            </div>

            <h1 class="text-balance text-4xl font-semibold leading-tight text-neutral-900 sm:text-5xl">
              {{ article.title }}
            </h1>

            {% if article.excerpt != blank %}
              <p class="text-lg leading-relaxed text-neutral-600">
                {{ article.excerpt | strip_html | strip }}
              </p>
            {% endif %}

            <div class="flex flex-wrap items-center gap-3 text-sm text-neutral-600">
              {{ published_at }}
              {% if article.author != blank %}
                <span class="text-neutral-400">•</span>
                <span class="font-medium text-neutral-900">
                  {{ 'blogs.article.meta.author_html' | t: author: article.author }}
                </span>
              {% endif %}
              {% if article.comments_count > 0 %}
                <span class="text-neutral-400">•</span>
                <span class="text-neutral-600">
                  {{ article.comments_count }}
                  {{ 'blogs.article.comments.title' | t }}
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="article-content space-y-8 text-lg leading-relaxed text-neutral-800">
          {{ article.content }}
        </div>

        {% if article.tags.size > 0 %}
          <div class="flex flex-col gap-3 rounded-[24px] border border-white/60 bg-white/80 p-6">
            <p class="text-xs font-semibold uppercase tracking-[0.35em] text-neutral-500">
              {{ 'blogs.article.tags_label' | t }}
            </p>
            <div class="flex flex-wrap gap-2">
              {% for tag in article.tags %}
                <a
                  href="{{ blog.url }}/tagged/{{ tag | handleize }}"
                  class="inline-flex items-center rounded-full border border-neutral-200 px-4 py-1.5 text-sm font-medium text-neutral-700 transition hover:border-neutral-400 hover:text-neutral-900"
                >
                  {{ tag }}
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {% if blog.comments_enabled? %}
          <div id="comments" class="flex flex-col gap-8 rounded-[28px] border border-white/60 bg-white/85 p-6 shadow-[0_30px_90px_rgba(15,23,42,0.08)] sm:p-10">
            <div class="flex flex-col gap-2">
              <div class="flex flex-wrap items-baseline justify-between gap-3">
                <h2 class="text-2xl font-semibold text-neutral-900">
                  {{ 'blogs.article.comments.title' | t }}
                </h2>
                {% if article.comments_count > 0 %}
                  <span class="text-sm text-neutral-500">
                    {{ article.comments_count }}
                  </span>
                {% endif %}
              </div>
              <p class="text-sm text-neutral-500">
                {{ 'blogs.article.comments.moderation_notice' | t }}
              </p>
            </div>

            {% paginate article.comments by 10 %}
              {% if article.comments_count > 0 %}
                <div class="space-y-4">
                  {% for comment in article.comments %}
                    {% assign comment_date = comment.created_at | time_tag: format: 'date' %}
                    {% assign comment_date = comment_date | replace: '<time', '<time class="text-sm text-neutral-500"' %}
                    <div class="rounded-3xl border border-neutral-200 bg-white/90 p-6 shadow-[0_20px_70px_rgba(15,23,42,0.08)]">
                      <div class="flex flex-wrap items-center justify-between gap-3">
                        <p class="text-base font-semibold text-neutral-900">
                          {{ comment.author }}
                        </p>
                        {{ comment_date }}
                      </div>
                      <div class="mt-4 text-base leading-relaxed text-neutral-700">
                        {{ comment.content }}
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="text-sm text-neutral-500">
                  {{ 'blogs.article.comments.empty' | t }}
                </p>
              {% endif %}

              {% if paginate.pages > 1 %}
                <div class="pt-4">
                  {{ paginate | default_pagination: anchor: 'comments' }}
                </div>
              {% endif %}
            {% endpaginate %}

            <div class="rounded-3xl border border-neutral-200 bg-white/90 p-6 shadow-[0_20px_70px_rgba(15,23,42,0.08)]">
              <h3 class="text-xl font-semibold text-neutral-900">
                {{ 'blogs.article.comments.form_title' | t }}
              </h3>

              {% form 'new_comment', article, class: 'mt-6 flex flex-col gap-6' %}
                {% if form.errors %}
                  <div class="rounded-2xl border border-red-200 bg-red-50/90 p-4 text-sm text-red-900">
                    {{ form.errors | default_errors }}
                  </div>
                {% elsif form.posted_successfully? %}
                  <p class="rounded-2xl border border-emerald-200 bg-emerald-50/90 p-4 text-sm text-emerald-900">
                    {{ 'blogs.article.comments.success' | t }}
                  </p>
                {% endif %}

                <div class="grid gap-6 md:grid-cols-2">
                  <div class="flex flex-col gap-2">
                    <label for="CommentForm-author" class="text-xs font-semibold uppercase tracking-[0.4em] text-neutral-500">
                      {{ 'blogs.article.comments.name_label' | t }}
                    </label>
                    <input
                      id="CommentForm-author"
                      class="w-full rounded-2xl border border-neutral-200 bg-white/80 px-4 py-3 text-base text-neutral-900 placeholder:text-neutral-400 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-[var(--product-accent)] focus:ring-offset-2 focus:ring-offset-white"
                      type="text"
                      name="comment[author]"
                      value="{{ form.author }}"
                      autocomplete="name"
                      required
                    >
                  </div>

                  <div class="flex flex-col gap-2">
                    <label for="CommentForm-email" class="text-xs font-semibold uppercase tracking-[0.4em] text-neutral-500">
                      {{ 'blogs.article.comments.email_label' | t }}
                    </label>
                    <input
                      id="CommentForm-email"
                      class="w-full rounded-2xl border border-neutral-200 bg-white/80 px-4 py-3 text-base text-neutral-900 placeholder:text-neutral-400 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-[var(--product-accent)] focus:ring-offset-2 focus:ring-offset-white"
                      type="email"
                      name="comment[email]"
                      value="{{ form.email }}"
                      autocomplete="email"
                      required
                    >
                  </div>
                </div>

                <div class="flex flex-col gap-2">
                  <label for="CommentForm-body" class="text-xs font-semibold uppercase tracking-[0.4em] text-neutral-500">
                    {{ 'blogs.article.comments.body_label' | t }}
                  </label>
                  <textarea
                    id="CommentForm-body"
                    class="min-h-[160px] rounded-2xl border border-neutral-200 bg-white/80 px-4 py-3 text-base leading-relaxed text-neutral-900 placeholder:text-neutral-400 focus:border-transparent focus:outline-none focus:ring-2 focus:ring-[var(--product-accent)] focus:ring-offset-2 focus:ring-offset-white"
                    name="comment[body]"
                    required
                  >{{- form.body -}}</textarea>
                </div>

                <div class="flex flex-wrap items-center gap-4">
                  <button
                    type="submit"
                    class="inline-flex items-center justify-center rounded-full px-8 py-3 text-xs font-semibold uppercase tracking-[0.45em] text-[var(--product-button-text-color)] [background:var(--product-button-background)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--product-accent)]"
                  >
                    {{ 'blogs.article.comments.submit' | t }}
                  </button>
                </div>
              {% endform %}
            </div>
          </div>
        {% endif %}
      </div>
    </article>
  </div>
</section>

{%- comment -%} Article structured data {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": {{ article.title | json }},
  "image": {%- if article.image -%}[{{ article.image | image_url: width: 1200 | json }}]{%- else -%}[]{%- endif -%},
  "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
  "author": {
    "@type": "Person",
    "name": {{ article.author | default: shop.name | json }}
  },
  "publisher": {
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {%- if shop.brand.logo -%}
    "logo": {
      "@type": "ImageObject",
      "url": {{ shop.brand.logo | image_url: width: 600 | json }}
    }
    {%- endif -%}
  },
  "description": {{ article.excerpt | default: article.summary | default: article.title | strip_html | truncate: 160 | json }},
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": {{ shop.url | append: article.url | json }}
  }
}
</script>

{% stylesheet %}
  .article-content h2 {
    font-size: clamp(1.75rem, 1.25rem + 1vw, 2.25rem);
    line-height: 1.2;
    color: #0f172a;
  }

  .article-content h3 {
    font-size: clamp(1.35rem, 1.1rem + 0.5vw, 1.65rem);
    line-height: 1.3;
    color: #111827;
  }

  .article-content p,
  .article-content ul,
  .article-content ol,
  .article-content blockquote {
    margin-bottom: 1.5rem;
  }

  .article-content ul,
  .article-content ol {
    padding-left: 1.5rem;
  }

  .article-content blockquote {
    border-left: 3px solid var(--product-accent, #783047);
    padding-left: 1.25rem;
    font-style: italic;
    color: #374151;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Article",
  "settings": [
    {
      "type": "select",
      "id": "article_theme",
      "label": "Theme palette",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "recupera",
          "label": "Recupera"
        },
        {
          "value": "boost",
          "label": "Boost"
        }
      ]
    }
  ]
}
{% endschema %}
