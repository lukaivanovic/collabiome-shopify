{% comment %}
  This section is used in the article template to render the article page, which
  displays the full content of the blog post and can optionally include a
  comments section for customers (not shown in this example).

  https://shopify.dev/docs/storefronts/themes/architecture/templates/article
{% endcomment %}

{% liquid
  assign words_per_minute = 220
  assign word_count = article.content | strip_html | split: ' ' | size
  assign reading_time = word_count | divided_by: words_per_minute
  assign reading_time_remainder = word_count | modulo: words_per_minute
  if reading_time == 0 and word_count > 0
    assign reading_time = 1
  endif
  if reading_time_remainder > 0
    assign reading_time = reading_time | plus: 1
  endif

  assign published_at = article.published_at | time_tag: format: 'date'
  assign published_at = published_at | replace: '<time', '<time class="font-semibold text-neutral-900"'

  assign article_theme = section.settings.article_theme | default: 'default'
  case article_theme
    when 'recupera'
      assign product_theme_class = 'product-theme-recupera'
    when 'boost'
      assign product_theme_class = 'product-theme-boost'
    else
      assign product_theme_class = 'product-theme-default'
  endcase
%}

<section class="relative {{ product_theme_class }}">
  {% if article.image %}
    <figure class="relative w-full h-80 md:h-150 overflow-hidden">
      {{
        article.image
        | image_url: width: 2048
        | image_tag: loading: 'eager', class: 'h-full w-full object-cover', sizes: '100vw', alt: article.image.alt
        | default: article.title
        | escape
      }}
      <div class="absolute inset-0 bg-gradient-to-b from-black/20 to-transparent"></div>
    </figure>
  {% endif %}

  <div class="container pt-20 -mt-80 md:-mt-150 pb-16 md:pb-24 lg:pb-28">
    <article class="relative isolate overflow-hidden {{ product_theme_class }}">
      <div class="absolute inset-0 opacity-80 [background:var(--product-background)]"></div>
      <div class="relative z-10 flex flex-col gap-12 bg-white/85 px-6 py-10 backdrop-blur-xl sm:px-10 lg:px-16">
        <div class="flex flex-col gap-6">
          <a
            href="{{ blog.url }}"
            class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.35em] text-neutral-500 transition-colors hover:text-[var(--product-accent)]"
          >
            {{ 'blogs.article.back_link' | t: blog: blog.title }}
            <span aria-hidden="true" class="text-[var(--product-accent)]">→</span>
          </a>

          <div class="flex flex-col gap-4">
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-[11px] font-semibold uppercase tracking-[0.4em] text-neutral-500">
              <span class="text-[var(--product-accent)]">
                {{ blog.title }}
              </span>
              {% if reading_time > 0 %}
                <span class="inline-flex items-center gap-2 text-neutral-400">
                  <span class="h-1 w-1 rounded-full bg-neutral-400"></span>
                  {{ 'blogs.article.meta.reading_time' | t: minutes: reading_time }}
                </span>
              {% endif %}
            </div>

            <h1 class="text-balance text-4xl font-semibold leading-tight text-neutral-900 sm:text-5xl">
              {{ article.title }}
            </h1>

            {% if article.excerpt != blank %}
              <p class="text-lg leading-relaxed text-neutral-600">
                {{ article.excerpt | strip_html | strip }}
              </p>
            {% endif %}

            <div class="flex flex-wrap items-center gap-3 text-sm text-neutral-600">
              {{ published_at }}
              {% if article.author != blank %}
                <span class="text-neutral-400">•</span>
                <span class="font-medium text-neutral-900">
                  {{ 'blogs.article.meta.author_html' | t: author: article.author }}
                </span>
              {% endif %}
              {% if article.comments_count > 0 %}
                <span class="text-neutral-400">•</span>
                <span class="text-neutral-600">
                  {{ article.comments_count }}
                  {{ 'blogs.article.comments.title' | t }}
                </span>
              {% endif %}
            </div>
          </div>
        </div>

        <div class="article-content space-y-8 text-lg leading-relaxed text-neutral-800">
          {{ article.content }}
        </div>

        {% if article.tags.size > 0 %}
          <div class="flex flex-col gap-3 rounded-[24px] border border-white/60 bg-white/80">
            <div class="flex flex-wrap gap-2">
              {% for tag in article.tags %}
                <a
                  href="{{ blog.url }}/tagged/{{ tag | handleize }}"
                  class="inline-flex items-center rounded-full border border-neutral-200 px-4 py-1.5 text-sm font-medium text-neutral-700 transition hover:border-neutral-400 hover:text-neutral-900"
                >
                  {{ tag }}
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    </article>
  </div>
</section>

{%- comment -%} Article structured data {%- endcomment -%}
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": {{ article.title | json }},
    "image": {%- if article.image -%}[{{ article.image | image_url: width: 1200 | json }}]{%- else -%}[]{%- endif -%},
    "datePublished": {{ article.published_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "dateModified": {{ article.updated_at | date: '%Y-%m-%dT%H:%M:%S%z' | json }},
    "author": {
      "@type": "Person",
      "name": {{ article.author | default: shop.name | json }}
    },
    "publisher": {
      "@type": "Organization",
      "name": {{ shop.name | json }},
      {%- if shop.brand.logo -%}
      "logo": {
        "@type": "ImageObject",
        "url": {{ shop.brand.logo | image_url: width: 600 | json }}
      }
      {%- endif -%}
    },
    "description": {{ article.excerpt | default: article.summary | default: article.title | strip_html | truncate: 160 | json }},
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": {{ shop.url | append: article.url | json }}
    }
  }
</script>

{% stylesheet %}
  .article-content h2 {
    font-size: clamp(1.75rem, 1.25rem + 1vw, 2.25rem);
    line-height: 1.2;
    color: #0f172a;
  }

  .article-content h3 {
    font-size: clamp(1.35rem, 1.1rem + 0.5vw, 1.65rem);
    line-height: 1.3;
    color: #111827;
  }

  .article-content p,
  .article-content ul,
  .article-content ol,
  .article-content blockquote {
    margin-bottom: 1.5rem;
  }

  .article-content ul,
  .article-content ol {
    padding-left: 1.5rem;
  }

  .article-content blockquote {
    border-left: 3px solid var(--product-accent, #783047);
    padding-left: 1.25rem;
    font-style: italic;
    color: #374151;
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Article",
  "settings": [
    {
      "type": "select",
      "id": "article_theme",
      "label": "Theme palette",
      "default": "default",
      "options": [
        {
          "value": "default",
          "label": "Default"
        },
        {
          "value": "recupera",
          "label": "Recupera"
        },
        {
          "value": "boost",
          "label": "Boost"
        }
      ]
    }
  ]
}
{% endschema %}
