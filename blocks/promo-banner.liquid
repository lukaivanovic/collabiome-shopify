{% doc %}
  Promo Banner Block

  Renders a promotional banner card with image, title, description, and optional link.
  Can be used as a nested block in mega menus and other sections.

  @example
  {% content_for 'block', type: 'promo-banner', id: 'banner-1' %}
{% enddoc %}

{% liquid
  assign url = block.settings.url | default: ''
  assign title = block.settings.title | default: ''
  assign description = block.settings.description | default: ''
  assign overlay_color = block.settings.overlay_color | default: '#000000'
  assign overlay_opacity = block.settings.overlay_opacity | default: 40
  assign media = block.settings.image | default: blank
  assign title_tag = 'h3'

  # If product is selected, use product data
  if block.settings.product != blank
    assign url = block.settings.product.url
    assign title = block.settings.product.title
    assign description = block.settings.product.description
    assign media = block.settings.product.featured_media
  endif

  unless url != blank and title != blank
    break
  endunless
%}

<a
  {{ block.shopify_attributes }}
  href="{{ url }}"
  class="relative w-full h-full flex items-end overflow-hidden bg-black text-white rounded-xl aspect-square px-3 py-3 flex-1"
>
  <div class="absolute inset-0 z-0 overflow-hidden" aria-hidden="true">
    {% if media != blank %}
      {{
        media
        | image_url: width: 800
        | image_tag: loading: 'lazy', sizes: '100vw', alt: title, class: 'absolute inset-0 w-full h-full object-cover'
      }}
    {% else %}
      <div class="w-full h-full bg-gradient-to-r from-black/60 to-black/30"></div>
    {% endif %}
    <div
      class="absolute inset-0 pointer-events-none"
      style="background: {{ overlay_color }}; opacity: {{ overlay_opacity | divided_by: 100.0 }};"
    ></div>
  </div>

  <div class="relative z-10 w-full flex justify-between gap-3">
    <div>
      <{{ title_tag }} class="font-semibold leading-snug text-white">
        {{ title | escape }}
      </{{ title_tag }}>
      {% if description != blank %}
        {% liquid
          assign description_text = description | strip_html | truncate: 80
        %}
        <p class="text-xs text-white/70 mt-1">
          {{ description_text }}
        </p>
      {% endif %}
    </div>
    <div class="flex items-center text-white [&>svg]:w-5 [&>svg]:h-5">
      {{ 'icon-chevron-right.svg' | inline_asset_content }}
    </div>
  </div>
</a>

{% schema %}
{
  "name": "Promo banner",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "info": "Optional: Select a product to use its details, or manually enter details below"
    },
    {
      "type": "url",
      "id": "url",
      "label": "Link URL"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title"
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image",
      "info": "Optional: If a product is selected, this will be overridden by the product image"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "Overlay opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 40
    }
  ],
  "presets": [
    {
      "name": "Promo banner"
    }
  ]
}
{% endschema %}
