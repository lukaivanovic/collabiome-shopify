{% doc %}
  Header Mega Menu - Supplements

  Renders a custom mega menu panel for the supplements collection.

  @example
  {% content_for 'block', type: 'header-mega-menu-supplements', id: 'mega-menu-supplements' %}
{% enddoc %}

{% liquid
  # Prefer block settings, then metafield, then fall back to collection products
  assign featured_products = blank
  assign supplements_collection = collections['dodaci-prehrani'] | default: collections.supplements

  # Use product list from settings if available
  if block.settings.featured_products != blank and block.settings.featured_products.size > 0
    assign featured_products = block.settings.featured_products
  else
    # Fall back to metafield or collection products
    if supplements_collection.metafields.custom and supplements_collection.metafields.custom.featured_products
      assign featured_products = supplements_collection.metafields.custom.featured_products.value
    endif

    if featured_products == blank
      assign featured_products = supplements_collection.products
    endif

    unless supplements_collection and supplements_collection != empty
      break
    endunless
  endif
%}

<div
  class="mega-menu-panel pointer-events-none absolute left-0 top-[calc(100%-16px)] w-full aria-[hidden=false]:pointer-events-auto"
  data-mega-menu-panel="{{ supplements_collection.handle }}"
  aria-hidden="true"
  {{ block.shopify_attributes }}
>
  <div class="container py-3">
    <div
      class="mega-menu-card rounded-2xl border border-black/12 bg-[var(--color-background-default)]"
      data-mega-menu-card
    >
      <div class="flex flex-row gap-3 p-8">
        {% for product in featured_products limit: 3 %}
          <a
            href="{{ product.url }}"
            class="group relative flex items-end overflow-hidden bg-black text-white rounded-xl aspect-square px-3 py-3 flex-1"
          >
            <div class="overflow-hidden" aria-hidden="true">
              {% if product.featured_media %}
                {{
                  product.featured_media
                  | image_url: width: 800
                  | image_tag:
                    loading: 'lazy',
                    sizes: '100vw',
                    alt: product.title,
                    class: 'absolute inset-0 w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-105'
                }}
              {% else %}
                <div class="w-full h-full bg-gradient-to-r from-black/60 to-black/30"></div>
              {% endif %}
            </div>

            <div class="relative z-10 w-full flex justify-between gap-3">
              <div>
                <h3 class="text-lg font-medium leading-snug text-white">
                  {{ product.title | escape }}
                </h3>
                {% if product.description != blank %}
                  {% liquid
                    assign product_description = product.description | strip_html | truncate: 80
                  %}
                  <p class="text-sm text-white/80 mt-1">
                    {{ product_description }}
                  </p>
                {% endif %}
              </div>
              <div class="flex items-center text-white [&>svg]:w-5 [&>svg]:h-5">
                {{ 'icon-chevron-right.svg' | inline_asset_content }}
              </div>
            </div>
          </a>
        {% endfor %}

        <div class="ml-auto flex flex-row justify-end w-full min-w-150 gap-3">
          {% content_for 'blocks' %}
        </div>
      </div>
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Mega menu - Supplements",
  "blocks": [
    {
      "type": "promo-banner"
    }
  ],
  "settings": [
    {
      "type": "product_list",
      "id": "featured_products",
      "label": "Featured products",
      "limit": 10,
      "info": "Select products to display in the mega menu. If no products are selected, the collection metafield or collection products will be used."
    }
  ],
  "presets": [
    {
      "name": "Mega menu - Supplements"
    }
  ]
}
{% endschema %}
